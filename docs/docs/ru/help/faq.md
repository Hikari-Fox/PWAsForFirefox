# Часто задаваемые вопросы

<style>
.md-typeset h2 + div > h3 {
  margin-top: .8em;
}
</style>

## Общие вопросы

### Что такое прогрессивные веб-приложения?

Согласно [MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps):

> Прогрессивное веб-приложение (PWA) — это приложение, которое создаётся с использованием технологий веб-платформы, но
> предоставляет пользовательский опыт, аналогичный платформенно-специфическому приложению.
>
> Как и веб-сайт, PWA может работать на нескольких платформах и устройствах из одного кода.
> Как и платформенно-специфическое приложение, его можно установить на устройство, оно может работать в оффлайн-режиме
> и в фоновом режиме, а также может интегрироваться с устройством и другими установленными приложениями.

### Что делает этот проект?

Хотя Firefox поддерживает многие API прогрессивных веб-приложений, он не поддерживает функциональность
для установки их в качестве отдельного системного приложения с опытом, похожим на приложение. Эта функциональность также известна как Site Specific Browser (SSB).

Этот проект создает модифицированную среду выполнения Firefox, чтобы позволить устанавливать веб-сайты как
отдельные приложения и предоставляет консольный инструмент и расширение браузера для установки, управления и использования
их. Для получения дополнительных сведений о том, как это достигается, вы можете ознакомиться на [странице «Как это работает»](../about/how-it-works.md).

### Как этот проект сравнивается с Chrome PWAs?

Большинство браузеров на основе Chromium имеют встроенную поддержку PWA/SSB, что упрощает начальную
настройку. В сравнении, этот проект реализован как расширение Firefox и дополнительная
нативная программа, что может сделать начальную настройку немного более сложной, но также позволяет
дополнительные функции, которые браузеры на основе Chromium не поддерживают.

Уникальные функции, которые поддерживает PWAsForFirefox, включают:

* **Поддержка отдельных профилей:** Хотя иногда может быть удобнее использовать
  один и тот же профиль для PWA и основного браузера (как это делается в Chromium), использование отдельных
  профилей позволяет делать больше вещей, которые невозможно сделать в Chromium. Это включает
  дополнительную настройку или использование нескольких учётных записей для одного и того же веб-приложения.

* **Больше возможностей настройки:** Этот проект поддерживает дополнительные возможности конфигурации,
  которые не поддерживают браузеры на основе Chromium. Опции настройки, которые поддерживает проект, включают
  возможность настройки панели инструментов браузера с помощью виджетов, различных настроек браузера
  для разных веб-приложений, установку дополнительных дополнений и т. д. Кроме того, поведение также
  может быть детально настроено с помощью доступных настроек.

* **Лучшая интеграция с рабочим столом:** Веб-приложения, установленные с помощью этого проекта, могут обеспечить
  лучшую визуальную и функциональную интеграцию, чем некоторые браузеры на основе Chromium. Кроме того,
  возможность настраивать внешний вид с помощью CSS позволяет веб-приложениям визуально соответствовать любой платформе.

* **Разнообразие браузеров:** Большинство сред выполнения веб-приложений в настоящее время основаны на Blink/WebKit, что
  ограничивает разнообразие в вебе. Будучи основанным на Firefox, этот проект предоставляет альтернативное
  среду выполнения и способствует разнообразию браузеров и более здоровой экосистеме веб-платформ.

* *И многое другое!*

## Установка

### Как установить этот проект?

Вы можете прочитать [страницу установки](../installation/requirements.md) для получения инструкций по установке.
Инструкции по установке нативной программы также отображаются непосредственно в мастере настройки расширения. Для инструкций по использованию вы можете ознакомиться с
[руководством пользователя](../user-guide/extension.md).

### Как установить этот проект с помощью PortableApps.com?

Проект предоставляет портативный установщик (`.paf.exe`), который можно скачать со страницы релизов GitHub. Рекомендуется установить его через платформу PortableApps.com для дополнительной интеграции с её меню приложений.

Перед тем как использовать расширение браузера с портативной версией, вам нужно будет запустить PWAsForFirefox Portable. Это запустит небольшую фоновую программу, которая гарантирует, что браузер подключен к портативной версии. Эту программу можно закрыть через значок в области уведомлений, когда она не нужна.

### Как установить этот проект в другое место?

Вы можете настроить места установки для большинства каталогов, используя переменные окружения во время сборки.
Однако это только изменит то, где программа ожидает файлы, и вам нужно будет вручную скопировать файлы в правильные места. Вам также нужно будет
вручную отредактировать манифест нативного приложения с правильным путём к коннектору.

Описание каждого каталога, их местоположения по умолчанию и список переменных окружения для их изменения доступны [на странице каталогов](../resources/installation-directories.md).
Если вы хотите указать местоположение в домашнем каталоге, начните переменную окружения с `~/`, и она будет расширена до домашнего каталога пользователя во время выполнения.

### Как установить среду выполнения браузера в другое место?

Если вы хотите установить среду выполнения в глобальный каталог, вы можете вручную установить
среду выполнения в каталог `runtime` [в системном каталоге данных](../resources/installation-directories.md#system-data)
и удалить любую существующую среду выполнения в каталоге пользовательских данных. Вам также нужно убедиться,
что каталог доступен для записи всеми пользователями, чтобы патчинг работал.

Изменение каталога среды выполнения на другие местоположения (не связанные с пользовательскими или системными каталогами данных)
требует редактирования исходного кода.

### Как использовать альтернативный браузер в качестве основного браузера?

Расширение должно работать с большинством активно разрабатываемых браузеров на основе Firefox или его форков.
Однако некоторые из них имеют разные места поиска для манифестов нативного сообщения, поэтому
расширение может не обнаружить нативную программу. Вам нужно будет проверить документацию
вашего браузера для конкретных местоположений манифеста и скопировать манифест в правильное место.

??? note "LibreWolf"

    === "Windows"

        Будет работать сразу, «из коробки».

    === "Linux"

        Вы можете выполнить следующие команды, чтобы создать symlink на местоположение LibreWolf с
        местоположением по умолчанию Firefox:

        ```shell
        ln -s ~/.mozilla/native-messaging-hosts ~/.librewolf/native-messaging-hosts
        sudo ln -s /usr/lib/mozilla/native-messaging-hosts /usr/lib/librewolf/native-messaging-hosts
        ```

        Этот метод рекомендован [документацией LibreWolf](https://librewolf.net/docs/faq/#how-do-i-get-native-messaging-to-work)
        и также включит другие расширения Firefox, которые используют нативное сообщение. В качестве альтернативы,
        вы можете скопировать или создать symlink только на манифест PWAsForFirefox:

        ```shell
        sudo mkdir -p /usr/lib/librewolf/native-messaging-hosts
        sudo ln -s /usr/lib/mozilla/native-messaging-hosts/firefoxpwa.json /usr/lib/librewolf/native-messaging-hosts/firefoxpwa.json
        ```

    === "macOS"

        Вы можете выполнить следующие команды, чтобы создать symlink на местоположение LibreWolf с
        местоположением по умолчанию Firefox:

        ```shell
        ln -s ~/Library/Application\ Support/Mozilla/NativeMessagingHosts ~/Library/Application\ Support/LibreWolf/NativeMessagingHosts
        sudo ln -s /Library/Application\ Support/Mozilla/NativeMessagingHosts /Library/Application\ Support/LibreWolf/NativeMessagingHosts
        ```

        Этот метод рекомендован [документацией LibreWolf](https://librewolf.net/docs/faq/#how-do-i-get-native-messaging-to-work-1)
        и также включит другие расширения Firefox, которые используют нативное сообщение. В качестве альтернативы,
        вы можете скопировать или создать symlink только на манифест PWAsForFirefox:

        ```shell
        sudo mkdir -p /Library/Application\ Support/LibreWolf/NativeMessagingHosts
        sudo ln -s /Library/Application\ Support/Mozilla/NativeMessagingHosts/firefoxpwa.json /Library/Application\ Support/LibreWolf/NativeMessagingHosts/firefoxpwa.json
        ```

??? note "Waterfox"

    Будет работать сразу, «из коробки».

### Как использовать альтернативный браузер в качестве браузера приложений?

Вместо использования стандартной среды выполнения (обычного Firefox), вы можете вручную скачать
альтернативную версию Firefox или форк Firefox (LibreWolf, IceCat, Waterfox и т. д.). Однако,
пожалуйста, имейте в виду, что совместимость с другими или неофициальными средами выполнения не гарантируется.

Чтобы применить модификации UserChrome к новой среде выполнения, вам может потребоваться [пропатчить профили и
среду выполнения](../user-guide/extension.md#patch-profiles-and-runtime) из настроек расширения.

???+ note "Generic"

    1. Скачайте «портативный» архив (бинарный tarball) для вашего предпочтительного Firefox-based браузера.
    2. Извлеките загруженный архив и скопируйте файлы [в каталог среды выполнения](../resources/installation-directories.md#runtime).
    3. Внутри этого каталога создайте symlink на основной бинарный файл вашего браузера как `firefox.exe`/`firefox`.

??? note "LibreWolf"

    === "Windows"

        1. Создайте [пустой каталог среды выполнения](../resources/installation-directories.md#runtime) (или очистите его, если он уже существует).
        2. Скачайте [последний файл `-windows-x86_64-portable.zip`](https://gitlab.com/librewolf-community/browser/bsys6/-/releases) из релизов LibreWolf.
        3. Извлеките файл и скопируйте **содержимое** `librewolf-VERSION\LibreWolf` в каталог среды выполнения.
        4. Откройте командную строку в этом каталоге и выполните `mklink firefox.exe librewolf.exe`.

    === "Linux"

        1. Создайте [пустой каталог среды выполнения](../resources/installation-directories.md#runtime) (или очистите его, если он уже существует).
        2. Скачайте [последний файл `-linux-x86_64-package.tar.bz2`](https://gitlab.com/librewolf-community/browser/bsys6/-/releases) из релизов LibreWolf.
        3. Извлеките файл и скопируйте его **содержимое** в каталог среды выполнения.
        4. Откройте терминал в этом каталоге и выполните: `ln librewolf firefox`.

    === "macOS"

        1. Создайте [пустой каталог среды выполнения](../resources/installation-directories.md#runtime) (или очистите его, если он уже существует).
        2. Скачайте [последний файл `-macos-x86_64-package.dmg`](https://gitlab.com/librewolf-community/browser/bsys6/-/releases) из релизов LibreWolf.
        3. Извлеките файл и скопируйте `LibreWolf/LibreWolf.app` в каталог среды выполнения.
        4. Переименуйте каталог `LibreWolf.app` в каталоге среды выполнения в `Firefox.app`.
        5. Откройте терминал внутри `Firefox.app/Contents/MacOS` и выполните: `ln librewolf firefox`.

??? note "Waterfox"

    === "Windows"

        1. Создайте [пустой каталог среды выполнения](../resources/installation-directories.md#runtime) (или очистите его, если он уже существует).
        2. Скачайте [последний установщик](https://www.waterfox.net/download/) с сайта Waterfox.
        3. Не запускайте установщик. Вместо этого используйте [7-Zip](https://7-zip.org/) для извлечения его содержимого.
        4. Скопируйте извлечённое **содержимое** каталога `core` в каталог среды выполнения.
        5. Откройте командную строку в этом каталоге и выполните `mklink firefox.exe waterfox.exe`.

    === "Linux"

        1. Создайте [пустой каталог среды выполнения](../resources/installation-directories.md#runtime) (или очистите его, если он уже существует).
        2. Скачайте [последний tarball](https://www.waterfox.net/download/) с сайта Waterfox.
        3. Извлеките файл и скопируйте **содержимое** каталога `waterfox` в каталог среды выполнения.
        4. Откройте терминал в этом каталоге и выполните: `ln waterfox firefox`.

    === "macOS"

        1. Создайте [пустой каталог среды выполнения](../resources/installation-directories.md#runtime) (или очистите его, если он уже существует).
        2. Скачайте [последний образ диска](https://www.waterfox.net/download/) с сайта Waterfox.
        3. Извлеките файл и скопируйте `Waterfox/Waterfox.app` в каталог среды выполнения.
        4. Переименуйте каталог `Waterfox.app` в каталоге среды выполнения в `Firefox.app`.
        5. Откройте терминал внутри `Firefox.app/Contents/MacOS` и выполните: `ln waterfox firefox`.

### Как использовать FUSE OverlayFS с браузером?

На совместимых дистрибутивах Linux можно использовать FUSE OverlayFS для связывания вашей глобальной
установки Firefox с средой выполнения PWAsForFirefox. Это устраняет необходимость управлять и
хранить две отдельные установки Firefox, но требует дополнительной настройки.

Подробные инструкции доступны [в GitHub gist](https://gist.github.com/filips123/29fb511a01ee8016a927a614f32979d3#file-readme-md).

!!! warning

    Использование FUSE OverlayFS не тестируется регулярно и может не работать со всеми версиями Firefox,
    которые предоставляют дистрибуции.

### Как сделать заголовок веб-приложения более нативным?

Проект нацелен на то, чтобы установленные веб-приложения выглядели нативно. Однако из-за большого количества
десктопных окружений Linux и вариантов настройки трудно обнаружить их и предоставить
правильные встроенные стили совместимости с каждым из них. Тем не менее, есть два способа,
как вы можете вручную добиться лучшей визуальной интеграции с вашей темой.

Один из способов достижения нативного заголовка — отключить клиентские украшения (CSD) для
установленных веб-приложений. Это можно сделать на странице настройки Firefox, сняв галочку
с заголовка. Однако это приведет к появлению отдельной панели, что может быть
нежелательным, визуально непривлекательным и неэффективным с точки зрения экрана.

Лучшее решение — вручную применить пользовательское CSS-оформление для настройки внешнего вида заголовка.
Смотрите [как применить пользовательское CSS к веб-приложениям](#how-to-apply-custom-css-to-web-apps) и включите
CSS для вашей платформы, который предоставлен ниже (вы также можете настроить его, если хотите).

??? note "Windows"

    Проект уже включает встроенный стиль для Windows, поэтому дополнительный CSS не требуется. Этот стиль включает
    элементы иконки и заголовка, выровненные по левому краю, как это обычно бывает в большинстве приложений Windows.

??? note "macOS"

    Проект уже включает встроенный стиль для macOS, поэтому дополнительный CSS не требуется. Этот стиль включает
    элементы иконки и заголовка, выровненные по центру, а элементы управления окнами
    слева, как это обычно бывает в большинстве приложений macOS.

??? note "Linux (GNOME, Cinnamon, MATE)"

    На GNOME, Cinnamon и MATE вы можете использовать следующий CSS, чтобы удалить иконку и центрировать заголовок:

    ```css
    @-moz-document url('chrome://browser/content/browser.xhtml') {
      /* Horizontally center the title element */
      .site-info {
        justify-content: center !important;
      }

      /* Remove the icon element */
      .tab-icon-image {
        display: none !important;
      }

      /* Remove space between hamburger menu and window controls */
      .titlebar-spacer[type="post-tabs"] {
        width: 0 !important;
      }
    }
    ```

??? note "Linux (KDE, Xfce, LXDE, LXQt)"

    На KDE, Xfce, LXDE и LXQt вы можете использовать следующий CSS, чтобы центрировать заголовок:

    ```css
    @-moz-document url('chrome://browser/content/browser.xhtml') {
      /* Horizontally center the title element */
      .site-info > .tab-label-container {
        position: relative;
        margin-left: auto;
        margin-right: auto;
        left: 9rem;
      }
    }
    ```

??? note "Linux (tiling WMs)"

    При использовании оконных менеджеров с тайлингом вы можете отключить панель иконок (которая
    обычно содержит элементы управления окнами и иконки виджетов) и вместо этого использовать
    нативный заголовок, предоставленный вашим WM. Вы можете сделать это, [разрешив скрытие панели иконок](../user-guide/browser.md#allowing-hiding-the-icon-bar)
    и скрыв её на странице настройки. После отключения вы можете временно показать её, используя сочетание клавиш ++ctrl+alt++.

### Как сделать заголовок веб-приложения использовать системный акцентный цвет?

На Windows можно сделать заголовок веб-приложения использовать системный акцентный цвет
для активных окон. Это можно сделать, [применив следующий пользовательский CSS](#how-to-apply-custom-css-to-web-apps):

```css
@-moz-document url('chrome://browser/content/browser.xhtml') {
  #navigator-toolbox:not(:-moz-window-inactive),
  #scrollbutton-up:not(:hover):not(:active):not(:-moz-window-inactive),
  #scrollbutton-down:not(:hover):not(:active):not(:-moz-window-inactive),
  .tabbrowser-tab:not(:-moz-window-inactive) {
    background: AccentColor !important;
    color: AccentColorText !important;
    fill: AccentColorText !important;
  }

  #firefox-view-button[open] > .toolbarbutton-icon,
  .tab-background:is([selected], [multiselected]) {
    background-color: color-mix(in srgb, currentColor 18%, transparent) !important;
    background-image: none !important;
  }
}
```

Вам также нужно отключить [опцию «Разрешить веб-приложениям переопределять цвет темы (заголовка)»](../user-guide/browser.md#allow-web-apps-to-dynamically-change-a-theme-color)
в настройках браузера приложения, чтобы предотвратить конфликты с примененными стилями.

!!! tip

    Если вы хотите использовать системный акцентный цвет для всех окон, включая неактивные,
    вы можете удалить <nobr>`:not(:-moz-window-inactive)`</nobr> из стилей.

!!! note

    Эти стили также могут работать на других операционных системах.

### Как применить пользовательское CSS к веб-приложениям?

Среда выполнения поддерживает загрузку пользовательского CSS (UserChromeCSS) так же, как и обычный Firefox.
Для получения дополнительных сведений и ресурсов о пользовательском CSS вы можете ознакомиться с [веб-сайтом UserChromeCSS](https://www.userchrome.org/).

Чтобы загрузить пользовательское CSS в профиль веб-приложения:

1. Найдите свой профиль веб-приложения в [каталоге профилей](../resources/installation-directories.md#profiles).
2. Внутри каталога профиля создайте каталог `chrome` (если он ещё не существует).
3. Внутри каталога `chrome` создайте файл `userChrome.css` (если он ещё не существует).
4. Скопируйте свой CSS в файл `userChrome.css`.
5. Включите `toolkit.legacyUserProfileCustomizations.stylesheets` в `about:config`.
6. Перезапустите веб-приложение.

Если вы хотите применить CSS к нескольким профилям, использование [шаблонов профилей](../user-guide/extension.md#default-profile-template)
может упростить это.

!!! warning

    Поскольку PWAsForFirefox включает свои собственные модификации, не все темы CSS Firefox могут быть совместимы.

### Как применить пользовательский JS к веб-приложениям?

Для продвинутых модификаций возможно загрузить пользовательский JS в среду выполнения с помощью [UserChromeJS
(Автоконфигурация скриптов запуска)](https://www.userchrome.org/what-is-userchrome-js.html).

Чтобы загрузить пользовательский JS в профиль веб-приложения:

1. Найдите свой профиль веб-приложения в [каталоге профилей](../resources/installation-directories.md#profiles).
2. Внутри каталога профиля создайте каталог `chrome` (если он ещё не существует).
3. Внутри каталога `chrome` создайте каталог `user` (если он ещё не существует).
4. Внутри каталога `user` создайте файл `boot.jsm` или `boot.sys.mjs` (если он ещё не существует).
5. Скопируйте свой JS в правильный файл (в зависимости от формата модуля).
6. Перезапустите веб-приложение.

Если вы хотите применить JS к нескольким профилям, использование [шаблонов профилей](../user-guide/extension.md#default-profile-template)
может упростить это.

!!! warning

    Поскольку PWAsForFirefox включает свои собственные модификации, не все скрипты JS Firefox могут быть совместимы.

    Такие скрипты очень мощные. Они могут модифицировать Firefox почти любым способом и влиять
    на операционную систему за пределами самого браузера. Это включает доступ к вашим пользовательским данным
    и возможность запускать произвольные программы. Пожалуйста, будьте очень осторожны при добавлении сторонних
    скриптов и убедитесь, что вы доверяете коду.

### Как удалить этот проект?

Чтобы полностью удалить проект, вы можете следовать приведённым ниже шагам. Это удалит
все установленные веб-приложения, включая их данные и другие настройки. Вы не сможете
откатить этот процесс, поэтому убедитесь, что вы сделали резервную копию всех важных данных.

1. Удалите все установленные веб-приложения с помощью расширения или [командной программы](../user-guide/console.md#uninstalling-a-web-app).
2. Удалите все профили веб-приложений с помощью расширения или [командной программы](../user-guide/console.md#removing-a-profile).
3. Удалите расширение PWAsForFirefox из браузера.
4. Удалите нативную программу PWAsForFirefox из системы.
5. Удалите [каталог пользовательских данных](../resources/installation-directories.md#user-data).

Чтобы удалить нативную программу, вам следует следовать инструкциям менеджера пакетов,
который вы использовали для её установки.

??? "Windows"

    Вы можете удалить нативную программу, используя настройки Windows или панель управления.

??? "Linux"

    Вы можете удалить нативную программу, используя менеджер пакетов, который вы использовали для её установки.
    Вы можете удалить пользовательский репозиторий и ключ, удалив их файлы из системы.

??? "macOS"

    Вы можете удалить нативную программу, используя Homebrew, выполнив команду `brew uninstall firefoxpwa`.

## Использование

### Как установить дополнения в браузер приложения?

Вы можете открыть встроенный менеджер дополнений, используя стандартное сочетание клавиш или меню
приложения. Вы также можете перейти в магазин дополнений, открыв поле ввода URL (нажав ++f6++, ++ctrl+l++ или ++alt+d++) и введя `addons.mozilla.org`.

### Как получить доступ к `about:config` в браузере приложения?

Вы можете получить доступ к `about:config` (или любому другому URL), открыв поле ввода URL (нажав ++f6++, ++ctrl+l++ или ++alt+d++) и введя `about:config`.

### Как добавить ярлык веб-приложения на рабочий стол?

Можно создать ярлык для веб-приложения и добавить его на рабочий стол или в другую директорию.

??? "Windows"

    1. Откройте каталог меню «Пуск»: `%AppData%\Microsoft\Windows\Start Menu\Programs`
    2. Скопируйте ярлык для вашего веб-приложения на рабочий стол или в другую директорию.

??? "Linux"

    1. Откройте каталог ярлыков: `~/.local/share/applications`
    2. Скопируйте ярлык для вашего веб-приложения на рабочий стол или в другую директорию.

??? "macOS"

    1. Откройте каталог приложений: `~/Applications`
    2. Удерживайте ++option+cmd++ и перетащите веб-приложение на рабочий стол или в другую директорию.

!!! warning

    Эти шаги могут не работать во всех десктопных окружениях.

### Как сделать резервную копию установленных веб-приложений или перенести их?

Чтобы сделать резервную копию установленных веб-приложений или перенести их на другой компьютер, вы можете скопировать
файл `config.json` и каталог `profiles` внутри [каталога пользовательских данных](../resources/installation-directories.md#user-data).

После восстановления данных вам нужно будет запустить [опцию «Обновить веб-приложения»](../user-guide/extension.md#update-web-apps)
в настройках расширения, чтобы зарегистрировать ваши веб-приложения в операционной системе.

## Устранение неполадок

### Почему я не могу установить конкретный веб-сайт, который хочу?

Если вы создаете сборку расширения для разработки самостоятельно, функция автоматической перезагрузки может
помешать работе расширения на определённых веб-сайтах. Чтобы иметь возможность устанавливать такие
веб-сайты, вам нужно либо создать сборку для продакшена, либо использовать предварительно собранное расширение.

[Некоторые сайты Mozilla](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts)
блокируют скрипты контента расширения по соображениям безопасности. Вы не можете установить эти сайты с помощью
расширения. Однако вы можете установить их вручную, используя командную программу.

Некоторые веб-сайты не могут быть установлены с включённым манифестом, потому что их манифесты
недействительны или не соответствуют спецификациям. Чтобы установить такие веб-сайты, вы можете
попробовать отключить использование манифеста для определения свойств приложения. Мы ведём
[список таких веб-сайтов](../resources/specific-website-tips.md#websites-with-invalid-manifests).

Если веб-сайт не является действительным PWA, действие страницы (в адресной строке) не появится по умолчанию. Однако вы можете установить такие веб-сайты из основного расширения/действия браузера
(то же место, где перечислены все установленные веб-приложения). Этот способ установки сайтов
не требует манифеста PWA, поэтому он должен работать с практически любым веб-сайтом.

В противном случае вы можете проверить [задачи по устранению неполадок](troubleshooting.md) и создать
новый issue, если это необходимо.

### Почему я не могу создать профиль, используя шаблон?

При создании профиля (или установке веб-приложения в новый профиль) с шаблоном вы
можете получить ошибку о несуществующих файлах или каталогах или недостаточных разрешениях.
Это может произойти, если вы скопировали каталог в шаблон, пока этот профиль работал, что привело к копированию файлов блокировки. Рекомендуется закрыть
профиль перед тем, как копировать его как шаблон, чтобы предотвратить такие проблемы.

Если создание профиля не удалось из-за предположительно несуществующих файлов или каталогов,
вы можете попытаться исправить эту проблему, удалив файл с именем lock внутри шаблона.

Если создание профиля не удалось из-за недостаточных разрешений, убедитесь, что вы применили
правильные разрешения ко всем файлам и каталогам внутри каталога шаблона.

### Почему браузер приложений выглядит как обычный Firefox?

Если браузер приложений выглядит как обычный Firefox, с отображаемыми вкладками и адресной строкой,
это может быть вызвано вашими настройками. Проверьте, включён ли [показ вкладок браузера и разрешение использования
многовкладочных веб-приложений](../user-guide/browser.md#show-browser-tabs-and-enable-using-multi-tabbed-web-apps)
или [отображение адресной строки](../user-guide/browser.md#changing-the-address-bar) установлено на всегда в настройках браузера приложений. Отключение этих опций может исправить вашу проблему.

Если соответствующие настройки отключены, но браузер приложений всё равно выглядит как обычный
Firefox, это вызвано отсутствующими патчами. Вы можете [пропатчить профили и
среду выполнения](../user-guide/extension.md#patch-profiles-and-runtime) из настроек расширения, чтобы повторно применить их.

### Почему всплывающее окно расширения обрезано в Linux?

Из-за [известной проблемы](https://github.com/filips123/PWAsForFirefox/issues/230) при использовании
доля отображения с дробным масштабированием в Linux всплывающее окно расширения может быть обрезано. В этом случае
вы можете не увидеть все элементы интерфейса, особенно кнопку установки веб-приложения.

Возможным обходным решением является использование клавиши ++tab++ для выбора кнопки и нажатие ++enter++
для её выполнения или временное отключение дробного масштабирования при установке веб-приложений.

### Почему расширение не находит нативный коннектор в Linux?

<!-- Headings here need to use HTML, so they don't appear in the table of contents -->

<h4>Если вы используете Firefox Snap (по умолчанию на Ubuntu)</h4>

Недавние версии Firefox Snap на Ubuntu поддерживают нативное сообщение. Сначала убедитесь, что
вы используете достаточно новую версию Firefox и Ubuntu.

Когда расширение впервые пытается получить доступ к нативному коннектору, должно появиться всплывающее окно разрешения,
которое вам нужно будет принять. Если всплывающее окно не появилось или вы отказали в разрешении,
вам нужно будет вручную разрешить это через командную строку:

```shell
flatpak permission-set webextensions firefoxpwa snap.firefox yes
```

Для выполнения этой команды вам потребуется установленный [Flatpak](https://flatpak.org/setup/).
После выполнения команды и подтверждения того, что расширение обнаружило нативный коннектор,
вы можете удалить Flatpak.

<h4>Если вы используете Firefox Flatpak</h4>

Flatpak пока не поддерживает нативное сообщение, но они работают над добавлением поддержки.
Вы можете следить за [проблемой `xdg-desktop-portal`](https://github.com/flatpak/xdg-desktop-portal/issues/655)
для получения информации о прогрессе.

Если вы хотите использовать PWAsForFirefox, вам нужно будет использовать Firefox из репозитория вашей дистрибуции или
сайта Mozilla. Другие обходные решения могут существовать, но они не поддерживаются официально.

<h4>Если вы используете Firefox из PPA или репозитория дистрибуции</h4>

Firefox, распространяемый с некоторыми дистрибуциями, может иметь ошибки, которые нарушают нативное сообщение.
Такие ошибки следует сообщать кураторам этого репозитория. Вы можете вместо этого использовать
Firefox, загруженный непосредственно с сайта Mozilla.

!!! tip

    Если у вас есть другие аналогичные проблемы, хорошим тестом будет проверить, работают ли другие дополнения,
    которые используют нативное сообщение (KeePassXC, Plasma Integration и т. д.), с вашей настройкой.
    Если они также не работают, это, вероятно, проблема с вашей версией/настройкой Firefox.
    Если они работают, это может быть проблема с PWAsForFirefox.

### Как исправить предупреждение о функциях безопасности на Linux?

Вы можете увидеть предупреждение о том, что «некоторые функции безопасности Firefox могут предлагать меньшую защиту
на вашей текущей операционной системе» на определённых дистрибутивах Linux.

Песочница в Firefox использует непривилегированные пространства имён пользователей при создании новых процессов
для обеспечения большей безопасности. Это можно считать риском безопасности, поэтому некоторые дистрибутивы Linux
начали ограничивать его использование и разрешают его работу только там, где есть профиль AppArmor. Вы можете узнать больше об этом предупреждении в [официальной документации Mozilla](https://support.mozilla.org/en-US/kb/install-firefox-linux#w_security-features-warning).

Текущий профиль AppArmor по умолчанию не может покрыть среду выполнения, используемую PWAsForFirefox,
поэтому вам нужно будет вручную создать пользовательский профиль AppArmor для среды выполнения.

Чтобы настроить пользовательский профиль AppArmor для среды выполнения, создайте файл с именем `firefoxpwa`
в `/etc/apparmor.d/` со следующим содержимым:

```apparmor
# Этот профиль позволяет всё и существует только для того, чтобы дать
# приложению имя вместо того, чтобы иметь метку unconfined

abi <abi/4.0>,
include <tunables/global>

profile firefoxpwa /home/<USER>/.local/share/firefoxpwa/runtime/firefox/{firefox,firefox-bin,updater} flags=(unconfined) {
  userns,

  # Специфические для сайта дополнения и переопределения. См. local/README для подробностей.
  include if exists <local/firefox>
}
```

Вы должны заменить `<USER>` на ваше имя пользователя. Вам также может потребоваться заменить путь
к среде выполнения в зависимости от вашего [каталога пользовательских данных](../resources/installation-directories.md#runtime).

После создания профиля вам нужно перезагрузить профили AppArmor:

```shell
sudo systemctl restart apparmor.service
```

### Почему расширение обнаруживает неправильную версию коннектора на Windows?

Из-за [известной проблемы](https://github.com/filips123/PWAsForFirefox/issues/268)
установщик может не обнаружить существующую установку PWAsForFirefox и вместо этого
установить новую версию рядом с существующей.

Эта проблема чаще всего возникает, если вы изначально установили PWAsForFirefox в
пользовательское местоположение, но сохранили параметры установки по умолчанию при установке обновлений,
что установило более новую версию отдельно в глобальный каталог.

Это может привести к тому, что расширение обнаружит и использует неправильный/старый нативный коннектор, который
может не содержать всех последних функций и исправлений.

Чтобы исправить эту проблему:

1. Удалите все существующие версии PWAsForFirefox из настроек Windows.

2. Удалите каталоги `C:\Program Files\FirefoxPWA` и `%LOCALAPPDATA%\Programs\FirefoxPWA`, если они существуют. Если вы ранее выбрали другой каталог установки, убедитесь, что вы также удалили его.

3. Удалите ключи реестра `HKLM\Software\filips\FirefoxPWA` и `HKCU\Software\filips\FirefoxPWA`, если они существуют.

4. Удалите ключи реестра `HKLM\Software\Mozilla\NativeMessagingHosts\firefoxpwa` и `HKCU\Software\Mozilla\NativeMessagingHosts\firefoxpwa`, если они существуют.

5. Переустановите PWAsForFirefox. Чтобы сделать менее вероятным повторное возникновение этой проблемы, рекомендуется установить PWAsForFirefox для всех пользователей и сохранить каталог установки по умолчанию (`C:\Program Files\FirefoxPWA`). Если вы вместо этого выберете другой вариант установки, убедитесь, что вы также запомнили его и всегда выбирали тот же вариант и каталог при установке обновлений.

6. Запустите [опцию «Пропатчить профили и среду выполнения»](../user-guide/extension.md#patch-profiles-and-runtime) из настроек расширения.

### Почему установка веб-приложения не удается на macOS?

Компиляция загрузчика при установке веб-приложения на macOS требует установки инструментов командной строки Xcode.

Они должны автоматически устанавливаться при использовании Homebrew. Если они не установлены,
вы можете установить их, выполнив следующую команду:

```shell
xcode-select --install
```

Если инструменты командной строки Xcode установлены, но установка веб-приложения всё ещё не удается,
вы можете попробовать удалить их, выполнив следующую команду, и установить их снова:

```shell
sudo rm -rf /Library/Developer/CommandLineTools```

### Why doesn't allowing microphone or camera work on macOS?

Due to [an unknown problem](https://github.com/filips123/PWAsForFirefox/issues/404),
trying to allow microphone or camera permissions may crash the web app on macOS.

As a workaround, it is possible to manually grant the required permissions to the
app browser using the steps below. This needs to be done once for every profile
where the microphone or camera access is required.

1. Create a web app into a new profile via the normal process.

2. Use ++cmd+i++ to manually open the permissions window and select the "Permissions" tab.

3. Set "Microphone" and "Camera" to "Always Allow".

4. Click the 9-box grid in the upper right of the Google banner and then select Google Search. Search for "webcamtests" and then open the `webcamtests.com` website from the results.

5. Run the webcam test and the microphone test one after another.

6. A permission dialogs from macOS should appear for each test ("Do you want to allow NAME to access the Microphone?", "Do you want to allow NAME to access the Camera?".

7. Answer yes to both dialogs.

8. The microphone and camera should now work.

